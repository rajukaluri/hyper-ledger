# Hyperledger Fabric Assignment for Internship

## Overview

This repository contains the implementation for the Hyperledger Fabric Internship Assignment. The project involves creating a blockchain-based system for a financial institution to manage and track assets. The system supports creating assets, updating asset values, querying the world state to read assets, and retrieving asset transaction history. Assets represent accounts with attributes such as DEALERID, MSISDN, MPIN, BALANCE, STATUS, TRANSAMOUNT, TRANSTYPE, and REMARKS. The goal is to ensure security, transparency, and immutability of asset records while providing an efficient way to track and manage asset-related transactions and histories.

The assignment is divided into three levels:
- **Level-1**: Setup Hyperledger Fabric test network.
- **Level-2**: Develop and test the smart contract for the above requirements.
- **Level-3**: Develop a REST API for invoking the smart contract deployed into the Hyperledger Fabric test network and create a Docker image for the REST API.

This implementation uses Go as the preferred programming language.

## Prerequisites

- Docker and Docker Compose (for running the Fabric test network).
- Go 1.21 or later (for building chaincode and REST API).
- Git (for cloning repositories and managing the project).
- Basic knowledge of Hyperledger Fabric concepts.

## Repository Structure

```
hyperledger-assignment/
├── README.md                # This file: setup, deployment, and usage instructions
├── chaincode/
│   ├── go.mod               # Go module file for chaincode dependencies
│   ├── go.sum               # Go sum file (generated by go mod tidy)
│   └── asset.go             # The smart contract code in Go
└── api/
    ├── go.mod               # Go module file for API dependencies
    ├── go.sum               # Go sum file (generated by go mod tidy)
    ├── main.go              # The REST API server code in Go, using Fabric Gateway
    └── Dockerfile           # Dockerfile to build the REST API image
```

## Setup Instructions

### Level-1: Setting Up Hyperledger Fabric Test Network

1. Clone the Hyperledger Fabric samples repository:
   ```
   git clone https://github.com/hyperledger/fabric-samples.git
   cd fabric-samples/test-network
   ```

2. Start the test network with a channel named `mychannel`:
   ```
   ./network.sh up createChannel -c mychannel -ca
   ```

   This sets up a basic network with two organizations (Org1 and Org2), peers, and orderers.

**References:**
- [What is Hyperledger Fabric?](https://hyperledger-fabric.readthedocs.io/en/latest/whatis.html)
- [Getting Started](https://hyperledger-fabric.readthedocs.io/en/latest/getting_started.html)
- [Test Network](https://hyperledger-fabric.readthedocs.io/en/latest/test_network.html)

### Level-2: Developing and Testing the Smart Contract

The smart contract (`asset.go`) supports:
- **CreateAsset**: Create a new asset.
- **UpdateAsset**: Update an existing asset.
- **ReadAsset**: Query an asset from the world state.
- **GetHistoryForAsset**: Retrieve transaction history for an asset.

1. Navigate to the chaincode directory in this repo:
   ```
   cd ../hyperledger-assignment/chaincode
   ```

2. Install dependencies:
   ```
   go mod tidy
   ```

3. Deploy the chaincode to the test network (from `fabric-samples/test-network`):
   ```
   ./network.sh deployCC -ccn asset -ccp /path/to/hyperledger-assignment/chaincode -ccl go
   ```

   Replace `/path/to/hyperledger-assignment/chaincode` with the absolute path to the chaincode folder.

4. Test the chaincode using peer CLI (example for creating an asset):
   ```
   peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile "${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem" -C mychannel -n asset --peerAddresses localhost:7051 --tlsRootCertFiles "${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt" --peerAddresses localhost:9051 --tlsRootCertFiles "${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt" -c '{"function":"CreateAsset","Args":["dealer1","1234567890","1234","1000.0","active","500.0","credit","initial deposit"]}'
   ```

**References:**
- [Smart Contracts](https://hyperledger-fabric.readthedocs.io/en/latest/smartcontract/smartcontract.html)
- [Asset Transfer Basic Sample](https://github.com/hyperledger/fabric-samples/tree/main/asset-transfer-basic/chaincode-go)
- [Deploy Chaincode](https://hyperledger-fabric.readthedocs.io/en/release-2.4/deploy_chaincode.html)
- [Invoking Chaincode](https://hyperledger-fabric.readthedocs.io/en/release-2.4/deploy_chaincode.html#invoking-the-chaincode)

### Level-3: Developing the REST API and Docker Image

The REST API uses the Fabric Gateway SDK to interact with the deployed chaincode. Endpoints:
- `POST /create`: Create an asset (JSON body with asset fields).
- `POST /update`: Update an asset (JSON body with asset fields; DEALERID must exist).
- `GET /read/{dealerID}`: Read an asset.
- `GET /history/{dealerID}`: Get transaction history.

1. Navigate to the API directory:
   ```
   cd ../hyperledger-assignment/api
   ```

2. Install dependencies:
   ```
   go mod tidy
   ```

3. Run the API locally (set environment variables first):
   ```
   export MSP_ID=Org1MSP
   export CERT_PATH=/path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem
   export KEY_PATH=/path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/priv_sk
   export TLS_CERT_PATH=/path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
   export PEER_ENDPOINT=localhost:7051
   export GATEWAY_PEER=peer0.org1.example.com
   go run main.go
   ```

   The API will listen on `http://localhost:8080`.

4. Build the Docker image:
   ```
   docker build -t fabric-rest-api .
   ```

5. Run the Docker container (mount or set env vars as needed):
   ```
   docker run -p 8080:8080 \
     -e MSP_ID=Org1MSP \
     -e CERT_PATH=/crypto/cert.pem \
     -e KEY_PATH=/crypto/priv_sk \
     -e TLS_CERT_PATH=/crypto/ca.crt \
     -e PEER_ENDPOINT=host.docker.internal:7051 \
     -e GATEWAY_PEER=peer0.org1.example.com \
     -v /path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem:/crypto/cert.pem \
     -v /path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/priv_sk:/crypto/priv_sk \
     -v /path/to/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt:/crypto/ca.crt \
     --network host \
     fabric-rest-api
   ```

   Adjust volume mounts to match your local paths.

6. Test the API (e.g., using curl for create):
   ```
   curl -X POST http://localhost:8080/create -H "Content-Type: application/json" -d '{"DEALERID":"dealer2","MSISDN":"9876543210","MPIN":"5678","BALANCE":2000.0,"STATUS":"active","TRANSAMOUNT":1000.0,"TRANSTYPE":"debit","REMARKS":"withdrawal"}'
   ```

**References:**
- [Fabric Gateway](https://hyperledger-fabric.readthedocs.io/en/latest/gateway.html)

## Technical Requirements

- **Programming Language**: Go, JavaScript, TypeScript, or Java (*Go is preferred*).



## Troubleshooting

- Ensure the test network is running before deploying the chaincode or running the API.
- Check logs for errors related to TLS certificates or file paths.
- Use the Hyperledger Fabric documentation or community forums for further assistance.

## Cleanup

To stop the test network:
```
cd fabric-samples/test-network
./network.sh down
```
